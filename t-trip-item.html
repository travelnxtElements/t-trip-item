<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../paper-menu-button/paper-menu-button.html" />
<link rel="import" href="./t-air-item.html">
<link rel="import" href="./t-hotel-item.html">
<link rel="import" href="./t-activity-item.html">
<link rel="import" href="./t-car-item.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html" />
<!--
    `t-trip-item` is trip listing item component.
    This component shows information of a single trip.
    It may contain one or more product depending upon booked itineraries.
	
	
Example:
        without event handlers
        <t-trip-api></t-trip-api>

        with data
        <t-list id="list" data-api="result.json" as="item" token-param="bookings" auto>
            <template>
                <t-trip-item trip="{{item}}"></t-trip-item>
            </template>
        </t-list>-->
<dom-module id="t-trip-item">
    <template>
    <link rel="import" type="css" href="iron-flex" />
    <style include="travel-element-styles">
    :host{
        display: block;
    }
    .block{
        display: block;
        margin: 10px 0;
    }
    .purchased{
        color: var(--success-color,green);
    }
    .cancelled{
        color: var(--error-color,red);
    }
    .planned{
        color: var(--notify-color, #e3b255);
    }
    paper-menu-button{
        padding: 0;
        position: absolute;
        right: -15px;
        top: -8px;
    }
    paper-icon-button{
        width: 36px;
        height: 36px;
    }
    .header-icon-holder{
        position: relative;
        overflow: hidden;
        padding-right: 15px;
    }
    paper-menu-button ::content > #dropdown{
        top: 0!important;
    }
    </style>
        <div class="section-small border-bottom">
            <div class="layout horizontal secondary-text font-12 header-icon-holder">
                <div class="flex layout vertical">
                    <div class="inventory-detail layout horizontal">
                        <div class="flex primary-light-text font-14">
                            [[model.name]]
                        </div>
                        <div class$="{{_getStatusClass(model.bookingStatus)}}">[[model.bookingStatus]]</div>
                    </div>
                    <div class="inventory-description">
                        Trip ID: [[model.confirmationNumber]]
                    </div>
                </div>
                <div class="icon">
                    <paper-menu-button horizontal-offset="-20" horizontal-align="right">
                      <paper-icon-button icon="more-vert" class="dropdown-trigger" noink></paper-icon-button>
                      <paper-menu class="dropdown-content">
                        <paper-item on-tap="_detailClick">Details</paper-item>
                        <!-- <paper-item>Delete</paper-item> -->
                      </paper-menu>
                    </paper-menu-button>
                </div>
            </div>
            <div>
                <template is="dom-repeat" items="{{model.inventoriesInfo}}">
                    <template is="dom-if" if="{{_isType(item,'flight')}}">
                        <t-air-item class="block" model="{{item}}"></t-air-item>
                    </template>
                    <template is="dom-if" if="{{_isType(item,'hotel')}}">
                        <t-hotel-item class="block" model="{{item}}"></t-hotel-item>
                    </template>
                    <template is="dom-if" if="{{_isType(item,'car')}}">
                        <t-car-item class="block" model="{{item}}"></t-car-item>
                    </template>
                    <template is="dom-if" if="{{_isType(item,'activity')}}">
                        <t-activity-item class="block" model="{{item}}"></t-activity-item>
                    </template>
                </template>
            </div>
        </div>
    </template>
</dom-module>
<script>
Polymer({
    is: "t-trip-item",

    properties: {

        /**
         * trip item.
         * This is required field.
         */
        model: {
            type: Object,
            value: null
        }
    },

    attached: function() {
    },

    _getStatusClass: function(status){
        if(!status){
            return;
        }
        return status.toLowerCase();
    },

    _detailClick: function(){
        this.fire('detail-click',this.model.confirmationNumber);
    },

    _isType: function(product,type){
        if (!product || !product.inventory)
            console.error("inventory not found!");

        return product.inventory.type.toLowerCase() === type;
    }
});
</script>
