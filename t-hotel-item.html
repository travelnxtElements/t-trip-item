<link rel="import" href="../polymer/polymer.html" />
<!--
    `t-hotel-item` hotel product component.
    This component shows information single hotel product.
    -->
<dom-module id="t-hotel-item">
    <template>
        <div>logo - [[logo]]</div>
        <div>name - [[name]]</div>
        <div>passenger count - [[passengerCount]]</div>
        <div>check in date - [[checkIn]]</div>
        <div>check out date - [[checkOut]]</div>
        <div>stay duration - [[stay]]</div>
        <div>status - [[status]]</div>
    </template>
</dom-module>
<script>
Polymer({
    is: "t-hotel-item",

    properties: {
        logo: {
            type: String,
            value: 'hotel logo'
        },

        /**
         * hotel product model.
         * This model is inventoriesInfo model of type 'Hotel' sent in mystique order api response
         * This is required field.
         */
        model: {
            type: Object,
            value: null
        }
    },

    attached: function() {
        this._populateModel();
    },

    _populateModel: function() {
        if (!this.model || !this.model.inventory || this.model.inventory.type.toLowerCase() !== 'hotel') {
            console.error("hotel inventory not found!");
            return;
        }

        this.name = this.model.inventory.name;
        this.status = this.model.bookingStatus;
        this._setDates();
        this._setStayCount();
        this._setPassengerCount();
    },

    _setStayCount: function() {
        this.stay = Math.round((new Date(this.checkOut) - new Date(this.checkIn)) / (1000 * 60 * 60 * 24));
    },

    _setPassengerCount: function() {

        if (!this.model.searchCriteria.rooms.length)
            return;

        var guestCount = 0;

        for (var i = 0; i < this.model.searchCriteria.rooms.length; i++) {
            guestCount += this.model.searchCriteria.rooms[i].adults.quantity;
            if (this.model.searchCriteria.rooms[i].children)
                guestCount += this.model.searchCriteria.rooms[i].children.quantity;
        }

        this.passengerCount = guestCount;
    },

    _setDates: function() {
        var month = ["Jan", "Feb", "March", "April", "May", "June", "July", "Aug", "Sep", "Oct", "Nov", "Dec"];

        if (this.model.inventory.stayDuration.start) {
            var checkIn = new Date(this.model.inventory.stayDuration.start.date);
            this.checkIn = checkIn.getDate() + ' ' + month[checkIn.getMonth()];
        }

        if (this.model.inventory.stayDuration.end) {
            var checkOut = new Date(this.model.inventory.stayDuration.end.date);
            this.checkOut = checkOut.getDate() + ' ' + month[checkOut.getMonth()];
        }
    }
});
</script>
