<link rel="import" href="../polymer/polymer.html" />
<!--
    `t-air-item` air product component.
    This component shows information single air product.
    -->
<dom-module id="t-air-item">
    <template>
        <div>logo - [[logo]]</div>
        <div>onward source - [[onwardSource]]</div>
        <div>return source - [[returnSource]]</div>
        <div>onward date - [[onwardDate]]</div>
        <div>return date - [[returnDate]]</div>
        <div>adult count - [[adultCount]]</div>
        <div>child count - [[childCount]]</div>
        <div>infant count - [[infantCount]]</div>
        <div>is round trip - [[isRoundTrip]]</div>
        <div>status - [[status]]</div>
    </template>
</dom-module>
<script>
Polymer({
    is: "t-air-item",

    properties: {

        /**
         * logo url.
         * This is required field.
         */
        logo: {
            type: String,
            value: 'flight logo'
        },

        /**
         * air product model.
         * This model is inventoriesInfo model of type 'Flight' sent in mystique order api response
         * This is required field.
         */
        model: {
            type: Object,
            value: null
        }
    },

    attached: function() {
        this._populateModel();
    },

    _populateModel: function() {
        if (!this.model || !this.model.inventory || this.model.inventory.type.toLowerCase() !== 'flight') {
            console.error("air inventory not found!");
            return;
        }

        this.isRoundTrip = this.model.inventory.itineraryType.toLowerCase() === "roundtrip";

        if (this.model.searchCriteria.legs.length && this.model.searchCriteria.legs[0].departureLocation)
            this.onwardSource = this.model.searchCriteria.legs[0].departureLocation.code;

        if (this.isRoundTrip && this.model.searchCriteria.legs.length && this.model.searchCriteria.legs[0].arrivalLocation)
            this.returnSource = this.model.searchCriteria.legs[0].arrivalLocation.code;

        this._setGuestCount();

        this._setDates();

        this.status = this.model.bookingStatus;
    },

    _setGuestCount: function() {

        //default values
        this.adultCount = 1;
        this.childCount = 0;
        this.infantCount = 0;

        if (!this.model.searchCriteria.passengers.length)
            return;

        for (var i = 0; i < this.model.searchCriteria.passengers.length; i++) {

            switch (this.model.searchCriteria.passengers[i].type.toLowerCase()) {
                case 'adult':
                    this.adultCount = this.model.searchCriteria.passengers[i].quantity;
                    break;
                case 'child':
                    this.childCount = this.model.searchCriteria.passengers[i].quantity;
                    break;
                case 'infant':
                    this.infantCount = this.model.searchCriteria.passengers[i].quantity;
                    break;
            }
        }
    },

    _setDates: function() {
        var month = ["Jan", "Feb", "March", "April", "May", "June", "July", "Aug", "Sep", "Oct", "Nov", "Dec"];

        if (this.model.inventory.departureTime) {
            var onwardDate = new Date(this.model.inventory.departureTime.date);
            this.onwardDate = onwardDate.getDate() + ' ' + month[onwardDate.getMonth()];
        }

        if (this.model.inventory.arrivalTime) {
            var returnDate = new Date(this.model.inventory.arrivalTime.date);
            this.returnDate = returnDate.getDate() + ' ' + month[returnDate.getMonth()];
        }
    }
});
</script>
